<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Risk Measures: VaR and CVaR (coherent risk basics)</title>
  <script>
    if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }
  </script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      line-height: 1.6;
      max-width: 900px;
      margin: 0 auto;
      padding: 24px;
      color: #111827;
      background: #ffffff;
    }
    h1, h2, h3 { color: #111827; }
    a { color: #2563eb; text-decoration: none; }
    a:hover { text-decoration: underline; }
    code { background-color: #f3f4f6; padding: 2px 6px; border-radius: 6px; }
    pre { background-color: #0b1020; color: #e5e7eb; padding: 16px; border-radius: 10px; overflow-x: auto; }
    pre code { background: transparent; padding: 0; }
    blockquote { border-left: 4px solid #e5e7eb; margin: 0; padding-left: 16px; color: #4b5563; }
    table { width: 100%; border-collapse: collapse; margin: 16px 0; }
    th, td { border: 1px solid #e5e7eb; padding: 8px; text-align: left; }
    th { background: #f9fafb; }
    hr { border: none; border-top: 1px solid #e5e7eb; margin: 24px 0; }

    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid #e5e7eb;
    }
    .back-link {
      font-weight: 600;
      text-decoration: none;
    }
    .back-link:hover {
      text-decoration: underline;
    }

    .theme-toggle {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 1.5rem;
      padding: 8px;
      border-radius: 50%;
      transition: background 0.2s;
    }
    .theme-toggle:hover {
      background: rgba(0,0,0,0.05);
    }
    .dark .theme-toggle:hover {
      background: rgba(255,255,255,0.1);
    }

    .dark body {
      background: #0f172a;
      color: #e2e8f0;
    }
    .dark h1, .dark h2, .dark h3 { color: #f1f5f9; }
    .dark a { color: #60a5fa; }
    .dark .page-header { border-bottom-color: #334155; }
    .dark code { background-color: #1e293b; color: #e2e8f0; }
    .dark pre {
      border: 1px solid #334155;
    }
    .dark blockquote {
      border-left-color: #334155;
      color: #94a3b8;
    }
    .dark th, .dark td { border-color: #334155; }
    .dark th { background: #1e293b; }
    .dark hr { border-top-color: #334155; }

    /* Copy Button */
    pre { position: relative; }
    .copy-button {
      position: absolute;
      top: 8px;
      right: 8px;
      padding: 4px 8px;
      font-size: 0.8rem;
      color: #94a3b8;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 4px;
      cursor: pointer;
      opacity: 0;
      transition: opacity 0.2s, background 0.2s;
    }
    pre:hover .copy-button, .copy-button:focus {
      opacity: 1;
    }
    .copy-button:hover {
      background: rgba(255, 255, 255, 0.2);
      color: #e2e8f0;
    }

    .skip-link {
      position: absolute;
      top: -40px;
      left: 0;
      background: #2563eb;
      color: white;
      padding: 8px 16px;
      z-index: 100;
      transition: top 0.2s;
      text-decoration: none;
      font-weight: bold;
    }
    .skip-link:focus {
      top: 0;
    }

  </style>
</head>
<body>
  <a href="#main-content" class="skip-link">Skip to content</a>

  <div class="page-header">
    <a href="../../../../../hubs/stochastic-programming-index.html" class="back-link">‚Üê Back to Stochastic Programming</a>
    <button id="theme-toggle" class="theme-toggle" aria-label="Toggle Dark Mode">üåô</button>
  </div>
  <main id="main-content" tabindex="-1">

<h1 id="topic-risk-measures-var-and-cvar-coherent-risk-basics">Topic: Risk Measures: VaR and CVaR (coherent risk basics)</h1>
<h2 id="1-formal-definition-what-is-it-and-how-can-we-use-it">1) Formal definition (what is it, and how can we use it?)</h2>
<ul>
<li>
<p><strong>Value at Risk (VaR):</strong> VaR at a confidence level Œ± (typically 95% or 99%) represents the maximum loss that is <em>not exceeded</em> with a probability of Œ± within a given time horizon. More formally, for a random variable <em>X</em> representing the loss (so larger values are worse), VaR<sub>Œ±</sub>(X) is the Œ±-quantile of the distribution of <em>X</em>. That is,</p>
<p>VaR<sub>Œ±</sub>(X) = inf{x ‚àà ‚Ñù : P(X ‚â§ x) ‚â• Œ±}</p>
<p>It answers the question: "What is the worst loss I can expect to experience Œ±% of the time?".</p>
<p>We use VaR to quantify the potential loss in a portfolio or investment over a specific period. It is a widely used risk measure in finance, but it has limitations because it doesn't say anything about the losses <em>beyond</em> the VaR level.</p>
</li>
<li>
<p><strong>Conditional Value at Risk (CVaR):</strong> CVaR, also known as Expected Shortfall (ES), is the expected loss given that the loss exceeds the VaR level. It's the average of the losses that occur in the (1-Œ±)% tail of the distribution. Formally:</p>
<p>CVaR<sub>Œ±</sub>(X) = E[X | X ‚â• VaR<sub>Œ±</sub>(X)]</p>
<p>CVaR addresses the limitation of VaR by considering the magnitude of losses beyond the VaR. It answers the question: "If the worst Œ±% scenarios occur, what is the <em>average</em> loss I should expect?".</p>
<p>CVaR is considered a <em>coherent</em> risk measure, satisfying the properties of:</p>
<ul>
<li><strong>Translation invariance:</strong> Adding a constant to the loss shifts the CVaR by the same constant.</li>
<li><strong>Subadditivity:</strong> The CVaR of a portfolio is less than or equal to the sum of the CVaRs of the individual assets.  This is crucial for diversification benefits; VaR is NOT always subadditive.</li>
<li><strong>Positive homogeneity:</strong> Scaling the loss by a positive constant scales the CVaR by the same constant.</li>
<li><strong>Monotonicity:</strong> If one loss is always less than another, its CVaR is also less than the other's CVaR.</li>
</ul>
<p>We use CVaR for more robust risk management because it considers the tail risk (losses beyond the VaR) and its coherence properties encourage diversification.</p>
</li>
</ul>
<h2 id="2-application-scenario">2) Application scenario</h2>
<p>Imagine an investment firm managing a portfolio of stocks. They want to assess the risk of their portfolio using VaR and CVaR.</p>
<ul>
<li>
<p><strong>VaR:</strong> They calculate the 95% VaR for the portfolio over a one-day period to be $1 million. This means there's a 5% chance they could lose more than $1 million in a single day. This gives a baseline understanding of the potential downside.</p>
</li>
<li>
<p><strong>CVaR:</strong> They then calculate the 95% CVaR to be $1.5 million. This means that if the portfolio experiences a loss exceeding the VaR (the worst 5% of scenarios), the average loss will be $1.5 million. This provides a more complete picture of the potential losses in extreme situations.</p>
</li>
</ul>
<p>The CVaR provides a clearer view of the magnitude of loss that could be incurred when the VaR level is breached. Knowing both helps the firm set appropriate risk controls and capital reserves. Because CVaR is subadditive, the firm can use it to optimize portfolio diversification strategies.  VaR can actually <em>discourage</em> diversification in some scenarios because it is not coherent.</p>
<h2 id="3-python-method-if-possible">3) Python method (if possible)</h2>
<pre class="codehilite"><code class="language-python">import numpy as np
import scipy.stats as st

def calculate_var(data, alpha):
  &quot;&quot;&quot;
  Calculates Value at Risk (VaR) for a given dataset and confidence level.

  Args:
    data: A numpy array of loss/return values.
    alpha: The confidence level (e.g., 0.95 for 95% VaR).

  Returns:
    The VaR value.
  &quot;&quot;&quot;
  return np.quantile(data, 1 - alpha)


def calculate_cvar(data, alpha):
  &quot;&quot;&quot;
  Calculates Conditional Value at Risk (CVaR) for a given dataset and confidence level.

  Args:
    data: A numpy array of loss/return values.
    alpha: The confidence level (e.g., 0.95 for 95% CVaR).

  Returns:
    The CVaR value.
  &quot;&quot;&quot;
  var = calculate_var(data, alpha)
  cvar = np.mean(data[data &gt;= var])  # Assuming 'data' represents losses. If returns, change &gt;= to &lt;=.
  return cvar


# Example usage:
returns = np.random.normal(0, 0.01, 1000)  # Simulate daily returns with 1% std dev.
losses = -returns # convert to losses

alpha = 0.95

var_95 = calculate_var(losses, alpha)
cvar_95 = calculate_cvar(losses, alpha)

print(f&quot;95% VaR: {var_95:.4f}&quot;)
print(f&quot;95% CVaR: {cvar_95:.4f}&quot;)


#Alternative approach using scipy.stats
# Assuming 'losses' is the numpy array representing losses
alpha = 0.95
var_95_alternative = st.scoreatpercentile(losses, alpha*100) #scipy uses percentile, so multiply alpha by 100

print(f&quot;95% VaR (scipy): {var_95_alternative:.4f}&quot;)
</code></pre>

<h2 id="4-follow-up-question">4) Follow-up question</h2>
<p>How can we estimate VaR and CVaR when we <em>don't</em> have a large historical dataset? For example, how could we use Monte Carlo simulation or Extreme Value Theory to estimate these risk measures?</p>
  </main>
  <script>
    const btn = document.getElementById('theme-toggle');
    const html = document.documentElement;
    
    function updateIcon() {
      btn.textContent = html.classList.contains('dark') ? '‚òÄÔ∏è' : 'üåô';
    }
    
    // Set initial icon
    updateIcon();

    btn.addEventListener('click', () => {
      if (html.classList.contains('dark')) {
        html.classList.remove('dark');
        localStorage.theme = 'light';
      } else {
        html.classList.add('dark');
        localStorage.theme = 'dark';
      }
      updateIcon();
    });

    // Copy Code Functionality
    document.querySelectorAll('pre').forEach(pre => {
      const button = document.createElement('button');
      button.className = 'copy-button';
      button.textContent = 'Copy';
      button.setAttribute('aria-label', 'Copy code to clipboard');

      pre.appendChild(button);

      button.addEventListener('click', async () => {
        const code = pre.querySelector('code');
        if (!code) return;

        try {
          await navigator.clipboard.writeText(code.innerText);
          button.textContent = 'Copied!';
          setTimeout(() => {
            button.textContent = 'Copy';
          }, 2000);
        } catch (err) {
          console.error('Failed to copy:', err);
          button.textContent = 'Error';
        }
      });
    });
  </script>
</body>
</html>
